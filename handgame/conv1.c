#include "conv1.h"
#include "mult_core.h"
// 2016.08.10
float ker_1[conv1_K][conv1_C][conv1_X][conv1_Y]={{{{-0.02462006919086,0.04108207672834,0.12680949270725,0.03739089891315,-0.06725898385048},{0.00361318909563,0.07544307410717,0.13900604844093,0.08489409089088,-0.06199967488647},{-0.05113034695387,0.04951655492187,0.06505735963583,0.08172339200974,-0.02879771590233},{-0.16324527561665,-0.16241173446178,-0.05278166010976,0.03544746711850,-0.00986345764250},{-0.08833239227533,-0.06446417421103,0.02246688306332,0.03336983546615,-0.00096049852436}},{{0.05162461102009,0.01009906362742,0.04074990376830,-0.01881780661643,-0.10037610679865},{0.03381662443280,-0.01490058097988,0.00650948565453,0.03593446314335,-0.05072789266706},{0.02377209253609,0.02132749184966,-0.03259461000562,0.05142519995570,0.00217154715210},{0.02633157745004,-0.07106088846922,-0.04508280009031,0.03116198629141,-0.01670621521771},{0.09759116917849,0.02224319241941,0.03570933267474,0.01101072970778,-0.03662153705955}},{{-0.01545878313482,-0.11716216057539,-0.08020717650652,0.03785408288240,0.09696663171053},{-0.03129064664245,-0.04762760177255,-0.16747243702412,-0.08496610075235,0.02552938461304},{0.12105375528336,0.26585009694099,-0.04458076879382,-0.09849654883146,0.02529081515968},{0.11434387415648,0.17443272471428,0.00381846795790,-0.08213615417480,0.02214827574790},{0.00243502715603,0.05755049362779,-0.01127724722028,-0.11207761615515,0.00312877679244}}},{{{-0.00003687777644,-0.00046853206004,-0.00067252450390,-0.00066810077988,-0.00030177363078},{-0.00063819414936,-0.00064939056756,-0.00093581440160,-0.00095001689624,-0.00047754496336},{-0.00042344469693,-0.00061443774030,-0.00053227361059,-0.00032136228401,-0.00057337270118},{-0.00049049127847,-0.00032090509194,-0.00060381594812,-0.00095543259522,-0.00086183787789},{-0.00029353439459,-0.00040890846867,-0.00105371547397,-0.00109674606938,-0.00105197762605}},{{-0.00000310028531,-0.00038932330790,-0.00098554568831,-0.00078411353752,-0.00037282597623},{-0.00076735846233,-0.00098880624864,-0.00107006065082,-0.00120344280731,-0.00064087368082},{-0.00030430246261,-0.00088883994613,-0.00067564152414,-0.00072274619015,-0.00099364854395},{-0.00039669618127,-0.00031093086000,-0.00080362136941,-0.00107350922190,-0.00110193609726},{-0.00052875099937,-0.00058823177824,-0.00108387588989,-0.00131746276747,-0.00105658848770}},{{-0.00023638035054,-0.00053915160242,-0.00101841636933,-0.00078823976219,-0.00064714043401},{-0.00057306647068,-0.00084644189337,-0.00107354775537,-0.00104756117798,-0.00083821598673},{-0.00040093620191,-0.00077633018373,-0.00073992658872,-0.00061512005050,-0.00109913898632},{-0.00048860441893,-0.00058776460355,-0.00122124468908,-0.00127749983221,-0.00132240320090},{-0.00048109571799,-0.00065486395033,-0.00117528135888,-0.00161465117708,-0.00124184892047}}},{{{-0.00202076672576,-0.00200543622486,-0.00180150591768,-0.00147585733794,-0.00134826090652},{-0.00248370319605,-0.00188356393483,-0.00154829537496,-0.00154060556088,-0.00160017155576},{-0.00218215724453,-0.00163527252153,-0.00126043451019,-0.00162582425401,-0.00162993837148},{-0.00194962183014,-0.00204656925052,-0.00167126650922,-0.00150751951151,-0.00194767117500},{-0.00204790430143,-0.00261723878793,-0.00238257856108,-0.00197324482724,-0.00220168172382}},{{-0.00255957408808,-0.00283718574792,-0.00260025821626,-0.00257101492025,-0.00195896066725},{-0.00338352331892,-0.00296193337999,-0.00244590383954,-0.00232647894882,-0.00245548924431},{-0.00290416181087,-0.00269956421107,-0.00206967396662,-0.00234593963251,-0.00251245056279},{-0.00274179759435,-0.00279886741191,-0.00233533955179,-0.00255336146802,-0.00281654344872},{-0.00299128936604,-0.00316806230694,-0.00329338270240,-0.00276393699460,-0.00311458669603}},{{-0.00345990178175,-0.00352584803477,-0.00346199586056,-0.00321682495996,-0.00275047682226},{-0.00405995501205,-0.00372907728888,-0.00308711081743,-0.00320437527262,-0.00319006782956},{-0.00402865558863,-0.00329156895168,-0.00275069451891,-0.00310502760112,-0.00350902997889},{-0.00357114314102,-0.00364865013398,-0.00333550921641,-0.00337537238374,-0.00349733559415},{-0.00398105615750,-0.00411500362679,-0.00417306367308,-0.00374235911295,-0.00390823418275}}},{{{-0.00029716541758,-0.00011788290431,0.00005652915206,-0.00000773424381,0.00010236651724},{-0.00010284316522,-0.00011231807730,0.00004380964674,0.00002536482134,-0.00018488506612},{0.00003468118302,0.00000305141930,-0.00000981451012,-0.00014824044774,-0.00000885902500},{-0.00020548999601,0.00008507077291,-0.00014527968597,-0.00005123718438,-0.00002024714195},{-0.00020935613429,-0.00008610335499,-0.00013864829089,-0.00000173277101,-0.00001628102109}},{{-0.00013092675363,0.00000090933651,0.00004224741497,0.00003929031300,-0.00003587682295},{-0.00013952729932,-0.00011169729987,-0.00019314984092,-0.00013170322927,0.00002779703027},{-0.00008917182276,-0.00003251101953,-0.00014767653192,-0.00010220787226,-0.00004482797885},{0.00000298402006,-0.00003625791942,0.00005230594616,0.00018569920212,-0.00005143497401},{0.00000570158227,-0.00021680082136,-0.00009847049660,-0.00014869628649,-0.00019152145251}},{{-0.00006431737711,-0.00016059275367,-0.00022218422964,-0.00029342566268,-0.00028052460402},{-0.00024640138145,0.00001071892530,-0.00003518245649,-0.00028527493123,-0.00017539360852},{-0.00009942217730,-0.00024957707501,-0.00030078817508,-0.00005768777191,-0.00013021718769},{-0.00017175146786,-0.00014260593161,-0.00008106682071,-0.00018536736025,-0.00008764531958},{-0.00022184618865,-0.00001960239933,-0.00010205362923,-0.00032324064523,-0.00008679294115}}},{{{-0.00081684096949,-0.00180913053919,-0.00250135897659,-0.00232142419554,-0.00188975140918},{-0.00158105872106,-0.00179015402682,-0.00191254925448,-0.00253285560757,-0.00172905565705},{-0.00138910755049,-0.00179886457045,-0.00198785797693,-0.00166070519481,-0.00186731293797},{-0.00147645932157,-0.00139318034053,-0.00130440772045,-0.00215672166087,-0.00147414393723},{-0.00129177910276,-0.00067572406260,-0.00163094222080,-0.00194494321477,-0.00196170993149}},{{-0.00098033028189,-0.00216940138489,-0.00269050104544,-0.00227095326409,-0.00197002524510},{-0.00161013053730,-0.00207966961898,-0.00193598365877,-0.00221624434926,-0.00173366279341},{-0.00131214375142,-0.00177659699693,-0.00209444435313,-0.00165207544342,-0.00165169627871},{-0.00155382114463,-0.00164927716833,-0.00153774092905,-0.00220702053048,-0.00143300509080},{-0.00133605953306,-0.00090618437389,-0.00184461055323,-0.00198426377028,-0.00226728036068}},{{-0.00138337607495,-0.00220621866174,-0.00281376577914,-0.00254288432188,-0.00245197932236},{-0.00190568028484,-0.00212752376683,-0.00216867099516,-0.00243447744288,-0.00211048591882},{-0.00164791720454,-0.00210083881393,-0.00221365806647,-0.00180213782005,-0.00207247794606},{-0.00214188033715,-0.00195803167298,-0.00206315657124,-0.00253712385893,-0.00176107836887},{-0.00208129431121,-0.00208649737760,-0.00253789615817,-0.00271897623315,-0.00255173956975}}},{{{-0.00040555794840,-0.00026507282746,-0.00026361498749,-0.00032393736183,-0.00042335083708},{-0.00029424348031,-0.00026618040283,-0.00008976212848,-0.00003830531205,-0.00021202559583},{-0.00042953365482,-0.00016938192130,-0.00027803512057,-0.00029893245664,-0.00024697332992},{-0.00044057006016,-0.00046436366392,-0.00038727093488,-0.00036492315121,-0.00046242499957},{-0.00047997481306,-0.00074376876000,-0.00053075904725,-0.00073207408423,-0.00075593468500}},{{-0.00041723684990,-0.00024585664505,-0.00023860296642,-0.00024342349207,-0.00053414900322},{-0.00045112767839,-0.00046494381968,0.00011319502664,-0.00022208319569,-0.00049175799359},{-0.00029407878174,-0.00038047763519,-0.00025785967591,-0.00054275686853,-0.00064237747574},{-0.00064322759863,-0.00039143743925,-0.00049075781135,-0.00063604570460,-0.00050361495232},{-0.00046996489982,-0.00067096989369,-0.00079662509961,-0.00081229541684,-0.00064874213422}},{{-0.00075342610944,-0.00050211197231,-0.00060256663710,-0.00061543082120,-0.00072042236570},{-0.00061416166136,-0.00057211169042,-0.00028219242813,-0.00049523601774,-0.00082030071644},{-0.00060719810426,-0.00072948238812,-0.00065829453524,-0.00063904287526,-0.00070287717972},{-0.00073962722672,-0.00078328436939,-0.00083311647177,-0.00092191097792,-0.00084957364015},{-0.00090624461882,-0.00100180576555,-0.00106865447015,-0.00101503822953,-0.00084647018230}}},{{{-0.00008609586803,0.00004860667104,-0.00012361904373,-0.00006919584848,-0.00001665597483},{-0.00014315727458,0.00001762091415,0.00003539802128,-0.00012701118249,-0.00014367979020},{0.00003014003050,0.00004348270159,0.00014392890444,-0.00007572791219,-0.00014807972184},{-0.00021853254293,-0.00007493850717,-0.00003056730202,-0.00005552651783,-0.00011404985707},{-0.00003764481880,-0.00011669490777,-0.00004570460806,-0.00011271351104,-0.00007199671381}},{{-0.00000808470486,-0.00000070610338,-0.00012214654998,-0.00017147959443,-0.00012715805497},{0.00007456725871,-0.00008010324382,-0.00010365264461,-0.00009196332394,-0.00016466638772},{-0.00024059692805,0.00006755889626,-0.00002917373422,0.00002099831363,0.00005438385779},{-0.00006073646364,-0.00008281910414,-0.00016292319924,-0.00012945236813,0.00004737630297},{-0.00014721561456,-0.00000449559502,-0.00012932588288,-0.00003728923548,-0.00006452410889}},{{-0.00008501587581,-0.00019527523546,-0.00014392916637,-0.00023777064052,-0.00018198936596},{0.00007014600124,-0.00002446075450,-0.00011550993077,-0.00002883376510,-0.00003114640276},{-0.00005899080497,-0.00000156656847,0.00005854843766,-0.00023272747057,-0.00013368818327},{-0.00009335175855,-0.00013164919801,0.00007191383338,-0.00029118268867,0.00014681667381},{-0.00012396524835,-0.00004850494952,0.00006366745947,-0.00010809834930,-0.00018845616432}}},{{{-0.00176163110882,-0.00175697996747,-0.00117490172852,-0.00130171352066,-0.00125265994575},{-0.00151504320092,-0.00122608081438,-0.00145099917427,-0.00167622871231,-0.00183516927063},{-0.00143465294968,-0.00183197250590,-0.00199925876223,-0.00175191776361,-0.00223223213106},{-0.00137886754237,-0.00106207025237,-0.00168263795786,-0.00204908917658,-0.00230426271446},{-0.00135362730362,-0.00099308392964,-0.00177042651922,-0.00211157859303,-0.00216732406989}},{{-0.00173532904591,-0.00164317036979,-0.00130384741351,-0.00152239622548,-0.00144821580034},{-0.00149502325803,-0.00120478251483,-0.00148338102736,-0.00188940961380,-0.00203259731643},{-0.00189728219993,-0.00196705525741,-0.00193496246357,-0.00166987592820,-0.00259387027472},{-0.00181749439798,-0.00145483925007,-0.00172664504498,-0.00203608558513,-0.00261559151113},{-0.00150112155825,-0.00135488319211,-0.00184872047976,-0.00241239066236,-0.00239629833959}},{{-0.00242367852479,-0.00236254720949,-0.00181871000677,-0.00215258332901,-0.00214405939914},{-0.00222454336472,-0.00202105520293,-0.00231235730462,-0.00289420899935,-0.00244974112138},{-0.00229434389621,-0.00276081776246,-0.00258035957813,-0.00266566220671,-0.00318024517037},{-0.00276236003265,-0.00238894927315,-0.00269425660372,-0.00311299297027,-0.00317303254269},{-0.00269552064128,-0.00247295969166,-0.00306902709417,-0.00317344232462,-0.00289255450480}}}};
float conv1_b[conv1_K]={0.00062068010448,0.00007693303633,-0.00002841452806,-0.00000019143999,-0.00001580011485,-0.00000417473802,-0.00000194957693,-0.00001599238385};

void conv1(float im[conv1_C][conv1_imX][conv1_imY],float rst[conv1_K][conv1_I][conv1_J])
{
    int k,i,j,c;
/*
    for(k=0;k<conv1_K;k++)
    {
        for(c=0;c<conv1_C;c++)
        {
            for(i=0;i<conv1_I;i++)
            {
                for(j=0;j<conv1_J;j++)
                {
                    for(x=0;x<conv1_X;x++)
                    {
                        for(y=0;y<conv1_Y;y++)
                        {
                            rst[k][i][j]+=ker[k][c][x][y]*im[c][i+x][j+y];
                        }
                    }
                }
            }
        }
    }
*/
    for(k=0;k<conv1_K;k++)
    {
    	 for(c=0;c<conv1_C;c++)
    	 {
    		 float result[28*28];
    		 mmult(ker_1[k][c],im[c],result);
    		 for(i=0;i<conv1_I;i++)for(j=0;j<conv1_J;j++)
    		 {
    			 rst[k][i][j]+=result[i*28+j];
    		 }
    	 }
    }

    for(k=0;k<conv1_K;k++)for(i=0;i<conv1_I;i++)for(j=0;j<conv1_J;j++)
    {
        rst[k][i][j]+=conv1_b[k];
        if(rst[k][i][j]<0)rst[k][i][j]=0;
    }
}

